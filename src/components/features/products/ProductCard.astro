---
import SecureQuickAddButton from './SecureQuickAddButton.tsx';

interface Props {
  productId: string;
  productSlug: string;
  name: string;
  price: number;
  imageUrl: string;
  description: string;
  category: string;
  variants: Array<{
    id: string;
    name: string;
    options: Record<string, string>;
    price: number;
    imageUrl?: string;
    printful_id?: number;
    printful_external_id?: string;
  }>;
  badge?: 'new' | 'sale' | 'featured';
}

const { 
  productId,
  productSlug,
  name, 
  price, 
  imageUrl = '/placeholder-product.jpg', 
  description, 
  category,
  variants,
  badge
} = Astro.props;

// Format price to currency
const formattedPrice = new Intl.NumberFormat('en-US', {
  style: 'currency',
  currency: 'USD'
}).format(price);

// Badge styling based on type
const badgeClasses = {
  new: 'bg-primary text-white',
  sale: 'bg-secondary text-white',
  featured: 'bg-accent text-white',
};
---

<div class="product-card group">
  {/* Product image */}
  <a href={`/shop/product/${productSlug}`} class="product-img-container">
    <img 
      src={imageUrl} 
      alt={name} 
      class="product-img" 
    />
    
    {/* Badge */}
    {badge && (
      <div class={`product-badge ${badgeClasses[badge]}`}>
        {badge}
      </div>
    )}
  </a>
  
  {/* Product info */}
  <div class="product-info">
    <div class="flex justify-between items-start">
      <div>
        <h3 class="product-title">
          <a href={`/shop/product/${productSlug}`} class="hover:text-primary">
            {name}
          </a>
        </h3>
        <p class="text-xs text-neutral-500 mb-2">{category}</p>
      </div>
      <span class="product-price">{formattedPrice}</span>
    </div>
    
    <p class="text-sm text-neutral-600 line-clamp-2 mb-4">{description}</p>
    
    <div class="flex justify-center">
      <SecureQuickAddButton 
        client:load
        productId={productId}
        productSlug={productSlug}
        productName={name}
        variants={variants}
      />
    </div>
  </div>
</div> 