---
import AdminLayout from "../../../layouts/AdminLayout.astro";
import { createServerSupabaseClient } from "../../../lib/supabase";

// Server-side rendering to ensure we can access cookies
export const prerender = false;

// Authentication is now handled by middleware in src/middleware.ts

// Fetch product statistics from the database
const supabase = createServerSupabaseClient({ cookies: Astro.cookies });

// Get total product count
const { data: productCount, error: productCountError } = await supabase
  .from('products')
  .select('count', { count: 'exact', head: true });

// Get active product count
const { data: activeProductCount, error: activeProductCountError } = await supabase
  .from('products')
  .select('count', { count: 'exact', head: true })
  .eq('active', true);

// Get count of pending product changes
const { data: pendingChanges, error: pendingChangesError } = await supabase
  .from('printful_product_changes')
  .select('count', { count: 'exact', head: true })
  .eq('status', 'pending_review');

// Get recent product updates
const { data: recentUpdates, error: recentUpdatesError } = await supabase
  .from('printful_sync_history')
  .select('*')
  .order('created_at', { ascending: false })
  .limit(3);

// Define types for our data
interface SyncHistory {
  id: string;
  created_at: string;
  sync_type: string;
  status: string;
  products_synced: number;
  products_failed: number;
}

---
<AdminLayout title="Product Management Hub">
  <div>Hello World</div>
</AdminLayout> 